<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Flintforge – Create Account</title>
  <style>
    :root { --bg: #1a1a1a; --text: #e0e0e0; --input-bg: #2d2d2d; --border: #444; --btn: #0066cc; --btn-hover: #004999; }
    @media (prefers-color-scheme: light) { :root { --bg: #f7f7f7; --text: #333; --input-bg: #fff; --border: #ccc; } }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; max-width: 380px; margin: 40px auto; padding: 20px; }
    input, button { width: 100%; padding: 10px; margin: 8px 0; font-size: 16px; border-radius: 4px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); }
    input::placeholder { color: #888; }
    button { background: var(--btn); color: #fff; cursor: pointer; font-weight: bold; }
    button:hover { background: var(--btn-hover); }
    #status { margin-top: 12px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Create Account</h2>
  <input id="email" placeholder="Email" type="email" required>
  <input id="pass" placeholder="Password" type="password" required>
  <button onclick="create()">Create</button>
  <div id="status"></div>

  <script>
    async function create() {
      const email = document.getElementById('email').value.trim();
      const pass = document.getElementById('pass').value;
      const status = document.getElementById('status');
      if (!email || !pass) return status.textContent = 'Fill all', status.style.color = 'red';

      status.textContent = 'Hashing...'; status.style.color = 'blue';

      // 1× SHA-256 on password only
      const enc = new TextEncoder();
      const hashBuf = await crypto.subtle.digest('SHA-256', enc.encode(pass));
      const passHash = Array.from(new Uint8Array(hashBuf)).map(b => b.toString(16).padStart(2, '0')).join('');

      status.textContent = 'Sending...';

      try {
        const r = await fetch('https://flintforge-proxy.onrender.com/create-account', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password: passHash })  // email raw, pass 1×
        });
        const j = await r.json();
        status.textContent = j.status === 'OK' ? 'Account created!' : `Failed: ${j.status}`;
        status.style.color = j.status === 'OK' ? 'green' : 'red';
      } catch (_) {
        status.textContent = 'Network error'; status.style.color = 'red';
      }
    }
  </script>
</body>
</html>
